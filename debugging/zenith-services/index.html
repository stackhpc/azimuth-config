
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/azimuth-logo-blue.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.8">
    
    
      
        <title>Debugging Zenith services - Azimuth Operator Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#debugging-zenith-services" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Azimuth Operator Documentation" class="md-header__button md-logo" aria-label="Azimuth Operator Documentation" data-md-component="logo">
      
  <img src="../../assets/azimuth-logo-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Azimuth Operator Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Debugging Zenith services
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/stackhpc/azimuth-config" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Azimuth Operator Documentation" class="md-nav__button md-logo" aria-label="Azimuth Operator Documentation" data-md-component="logo">
      
  <img src="../../assets/azimuth-logo-white.png" alt="logo">

    </a>
    Azimuth Operator Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stackhpc/azimuth-config" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../try/" class="md-nav__link">
        Try Azimuth
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../best-practice/" class="md-nav__link">
        Best practice for deployments
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../environments/" class="md-nav__link">
        Environments
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../repository/">Repository</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Repository" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Repository
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../repository/secrets/" class="md-nav__link">
        Managing secrets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../repository/opentofu/" class="md-nav__link">
        OpenTofu state
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../configuration/">Configuration</a>
          
            <label for="__nav_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Configuration" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/01-prerequisites/" class="md-nav__link">
        Prerequisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/02-deployment-method/" class="md-nav__link">
        Deployment method
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/03-kubernetes-config/" class="md-nav__link">
        Kubernetes configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/04-target-cloud/" class="md-nav__link">
        Target OpenStack cloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/05-secret-key/" class="md-nav__link">
        Secret key
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/06-ingress/" class="md-nav__link">
        Ingress
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/07-platform-identity/" class="md-nav__link">
        Platform Identity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/08-zenith/" class="md-nav__link">
        Zenith Application Proxy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/09-community-images/" class="md-nav__link">
        Community images
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/10-kubernetes-clusters/" class="md-nav__link">
        Kubernetes clusters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/11-kubernetes-apps/" class="md-nav__link">
        Kubernetes apps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/12-caas/" class="md-nav__link">
        Cluster-as-a-Service (CaaS)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/13-access-control/" class="md-nav__link">
        Access control
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/14-monitoring/" class="md-nav__link">
        Monitoring and alerting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/15-disaster-recovery/" class="md-nav__link">
        Disaster Recovery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/16-local-customisations/" class="md-nav__link">
        Local customisations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../deployment/">Deployment</a>
          
            <label for="__nav_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/automation/" class="md-nav__link">
        Automating deployments
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Debugging</a>
          
            <label for="__nav_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Debugging" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Debugging
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../access-k3s/" class="md-nav__link">
        Accessing the K3S cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../access-ha/" class="md-nav__link">
        Accessing the HA cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../access-monitoring/" class="md-nav__link">
        Accessing the monitoring
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Debugging Zenith services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Debugging Zenith services
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#client-not-connecting-to-sshd" class="md-nav__link">
    Client not connecting to SSHD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-not-registered-in-consul" class="md-nav__link">
    Client not registered in Consul
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oidc-credentials-not-created" class="md-nav__link">
    OIDC credentials not created
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-resources-for-the-zenith-service-have-not-been-created" class="md-nav__link">
    Kubernetes resources for the Zenith service have not been created
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cert-manager-fails-to-obtain-a-certificate" class="md-nav__link">
    cert-manager fails to obtain a certificate
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../consul/" class="md-nav__link">
        Debugging Consul
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes/" class="md-nav__link">
        Debugging Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../caas/" class="md-nav__link">
        Debugging Cluster-as-a-Service
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../developing/">Developing</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Developing" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Developing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#client-not-connecting-to-sshd" class="md-nav__link">
    Client not connecting to SSHD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#client-not-registered-in-consul" class="md-nav__link">
    Client not registered in Consul
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oidc-credentials-not-created" class="md-nav__link">
    OIDC credentials not created
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-resources-for-the-zenith-service-have-not-been-created" class="md-nav__link">
    Kubernetes resources for the Zenith service have not been created
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cert-manager-fails-to-obtain-a-certificate" class="md-nav__link">
    cert-manager fails to obtain a certificate
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="debugging-zenith-services">Debugging Zenith services</h1>
<p>If a Zenith service does not become available, the most common causes are:</p>
<h2 id="client-not-connecting-to-sshd">Client not connecting to SSHD</h2>
<p>The first thing that happens to connect a Zenith service is that the Zenith client
must connect to the Zenith SSHD. To see if a Zenith client is connecting, check for the
Zenith subdomain in the logs of the SSHD server:</p>
<div class="highlight"><span class="filename">On the K3S node, targetting the HA cluster if deployed</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>azimuth<span class="w"> </span>logs<span class="w"> </span>deploy/zenith-server-sshd<span class="w"> </span><span class="o">[</span>-f<span class="o">]</span>
</code></pre></div>
<p>If there are no logs for the target Zenith subdomain, this usually indicates a problem
with the client. Check the logs for the client and restart it if necessary. If problems
persist, try restarting the Zenith SSHD:</p>
<div class="highlight"><span class="filename">On the K3S node, targetting the HA cluster if deployed</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>azimuth<span class="w"> </span>rollout<span class="w"> </span>restart<span class="w"> </span>deployment/zenith-server-sshd
</code></pre></div>
<h2 id="client-not-registered-in-consul">Client not registered in Consul</h2>
<p>Once a client has connected to SSHD successfully, it should get registered in
<a href="https://www.consul.io/">Consul</a>.</p>
<p>To determine if this is the case, it is useful to access the Consul UI. As discussed
in <a href="../../configuration/14-monitoring/">Monitoring and alerting</a>, the Consul UI
is exposed as <code>consul.&lt;ingress base domain&gt;</code>, e.g. <code>consul.azimuth.example.org</code>,
and is protected by a username and password.</p>
<p>The default view shows Consul's view of the services, where you can check if the
service is being registered correctly.</p>
<p>Clients not registering correctly in Consul usually indicates an issue with Consul
itself. Futher information for debugging Consul issues is provided in
<a href="../consul/">Debugging Consul</a>.</p>
<p>If the issue persists once Consul issues are ruled out, try restarting SSHD:</p>
<div class="highlight"><span class="filename">On the K3S node, targetting the HA cluster if deployed</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>azimuth<span class="w"> </span>rollout<span class="w"> </span>restart<span class="w"> </span>deployment/zenith-server-sshd
</code></pre></div>
<h2 id="oidc-credentials-not-created">OIDC credentials not created</h2>
<p>Keycloak OIDC credentials for Zenith services for platforms deployed using Azimuth are created
by the <a href="https://github.com/stackhpc/azimuth-identity-operator">azimuth-identity-operator</a>.</p>
<p>To see if this step has happened, check the status of the <code>realm</code> and <code>platform</code> resources
created by the identity operator. They should all be in the <code>Ready</code> phase:</p>
<div class="highlight"><span class="filename">On the K3S node, targetting the HA cluster if deployed</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$ kubectl get realm,platform -A
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>NAMESPACE   NAME                                          PHASE   TENANCY ID      OIDC ISSUER                                           AGE
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>az-demo     realm.identity.azimuth.stackhpc.com/az-demo   Ready   xxxxxxxxxxxxx   https://identity.azimuth.example.org/realms/az-demo   4d2h
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>NAMESPACE   NAME                                                        PHASE   AGE
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>az-demo     platform.identity.azimuth.stackhpc.com/kube-mykubecluster   Ready   114s
</code></pre></div>
<p>If any of these resources stay in an unready state for more than a few minutes, try restarting
the identity operator:</p>
<div class="highlight"><span class="filename">On the K3S node, targetting the HA cluster if deployed</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>azimuth<span class="w"> </span>rollout<span class="w"> </span>restart<span class="w"> </span>deployment/azimuth-identity-operator
</code></pre></div>
<h2 id="kubernetes-resources-for-the-zenith-service-have-not-been-created">Kubernetes resources for the Zenith service have not been created</h2>
<p>If the service exists in Consul, it is possible that the process that synchronises Consul
services with Kubernetes resources is not functioning correctly. To check if Kubernetes
resources are being created, run the following command and check that the <code>Ingress</code>,
<code>Service</code> and <code>Endpoints</code> resources have been created for the service:</p>
<div class="highlight"><span class="filename">On the K3S node, targetting the HA cluster if deployed</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>$ kubectl -n zenith-services get ingress,service,endpoints
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>NAME                                                            CLASS   HOSTS                                                     ADDRESS         PORTS     AGE
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>ingress.networking.k8s.io/cjzm03yczuj6oqrj3h8htl4u1bbx96qd53g   nginx   cjzm03yczuj6oqrj3h8htl4u1bbx96qd53g.azimuth.example.org   96.241.100.96   80, 443   2d
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>ingress.networking.k8s.io/i03xvflgk1zmtcsdm2x5z5lz9qz05027euw   nginx   i03xvflgk1zmtcsdm2x5z5lz9qz05027euw.azimuth.example.org   96.241.100.96   80, 443   2d
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>ingress.networking.k8s.io/pxmvy7235x2ggfvf2op615gvz2v59wkqglc   nginx   pxmvy7235x2ggfvf2op615gvz2v59wkqglc.azimuth.example.org   96.241.100.96   80, 443   2d
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>ingress.networking.k8s.io/txn3zidfdnru5rg109voh848n51rvicmr1s   nginx   txn3zidfdnru5rg109voh848n51rvicmr1s.azimuth.example.org   96.241.100.96   80, 443   2d
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>NAME                                          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>service/cjzm03yczuj6oqrj3h8htl4u1bbx96qd53g   ClusterIP   172.27.10.109    &lt;none&gt;        80/TCP    2d
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>service/i03xvflgk1zmtcsdm2x5z5lz9qz05027euw   ClusterIP   172.30.203.227   &lt;none&gt;        80/TCP    2d
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>service/pxmvy7235x2ggfvf2op615gvz2v59wkqglc   ClusterIP   172.28.51.148    &lt;none&gt;        80/TCP    2d
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>service/txn3zidfdnru5rg109voh848n51rvicmr1s   ClusterIP   172.29.136.245   &lt;none&gt;        80/TCP    2d
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>NAME                                            ENDPOINTS                                                     AGE
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>endpoints/cjzm03yczuj6oqrj3h8htl4u1bbx96qd53g   172.18.152.99:34665                                           2d
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>endpoints/i03xvflgk1zmtcsdm2x5z5lz9qz05027euw   172.18.152.99:39409                                           2d
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>endpoints/pxmvy7235x2ggfvf2op615gvz2v59wkqglc   172.18.152.99:44761,172.18.152.99:36483,172.18.152.99:46449   2d
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>endpoints/txn3zidfdnru5rg109voh848n51rvicmr1s   172.18.152.99:45379                                           2d
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If an ingress resource does not have an IP, this may be a sign that the ingress controller
is not correctly configured or not functioning correctly.</p>
</div>
<p>If they do not exist, try restarting the Zenith sync component:</p>
<div class="highlight"><span class="filename">On the K3S node, targetting the HA cluster if deployed</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>azimuth<span class="w"> </span>rollout<span class="w"> </span>restart<span class="w"> </span>deployment/zenith-server-sync
</code></pre></div>
<h2 id="cert-manager-fails-to-obtain-a-certificate">cert-manager fails to obtain a certificate</h2>
<p>If you are using cert-manager to dynamically allocate certificates for Zenith services it
is possible that cert-manager has failed to obtain a certificate for the service, e.g. because
it has been rate-limited.</p>
<p>To check if this is the case, check the state of the certificates for the Zenith services:</p>
<div class="highlight"><span class="filename">On the K3S node, targetting the HA cluster if deployed</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>$ kubectl -n zenith-services get certificate
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>NAME                                      READY   SECRET                                    AGE
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>tls-cjzm03yczuj6oqrj3h8htl4u1bbx96qd53g   True    tls-cjzm03yczuj6oqrj3h8htl4u1bbx96qd53g   2d
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>tls-i03xvflgk1zmtcsdm2x5z5lz9qz05027euw   True    tls-i03xvflgk1zmtcsdm2x5z5lz9qz05027euw   2d
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>tls-txn3zidfdnru5rg109voh848n51rvicmr1s   True    tls-txn3zidfdnru5rg109voh848n51rvicmr1s   2d
</code></pre></div>
<p>If the certificate for the service is not ready, check the details for the certificate using
<code>kubectl describe</code> and check for any errors that have occured.</p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">March 15, 2024</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">March 15, 2024</span>
      
    
  </small>
</div>

              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../access-monitoring/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Accessing the monitoring" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Accessing the monitoring
            </div>
          </div>
        </a>
      
      
        
        <a href="../consul/" class="md-footer__link md-footer__link--next" aria-label="Next: Debugging Consul" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Debugging Consul
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; StackHPC 2022
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.0238f547.min.js"></script>
      
    
  </body>
</html>